<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #27ae60; /* –û—Å–Ω–æ–≤–Ω–æ–π –∑–µ–ª–µ–Ω—ã–π */
            --bg: #ffffff;
            --secondary-bg: #f5f5f5;
            --text-main: #1a1a1a;
            --text-muted: #7a7a7a;
            --radius: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
        }

        /* –®–∞–ø–∫–∞ */
        header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .logo { font-weight: 700; font-size: 1.2rem; color: var(--primary); }

        /* –ü–æ–∏—Å–∫ (–¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π) */
        .search-bar {
            padding: 0 20px 10px;
        }
        .search-input {
            width: 100%;
            padding: 12px;
            background: var(--secondary-bg);
            border: none;
            border-radius: 12px;
            box-sizing: border-box;
            font-size: 1rem;
        }

        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 10px 20px;
        }
        .cat-item {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .cat-icon {
            background: var(--secondary-bg);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 5px;
            font-size: 1.5rem;
        }

        /* –¢–æ–≤–∞—Ä—ã */
        .section-title { padding: 10px 20px; margin: 0; font-size: 1.3rem; }

        .products-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 10px 20px 120px;
        }

        .product-card {
            background: var(--bg);
            border: 1px solid var(--secondary-bg);
            border-radius: var(--radius);
            padding: 12px;
            display: flex;
            flex-direction: column;
        }

        .product-img {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: contain;
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .product-price {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 5px 0;
        }

        .product-name {
            font-size: 0.9rem;
            color: var(--text-main);
            margin-bottom: 10px;
            height: 2.4em;
            overflow: hidden;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .add-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 12px;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
        }

        .qty-controls {
            display: none;
            justify-content: space-between;
            align-items: center;
            background: var(--secondary-bg);
            border-radius: 12px;
            padding: 2px;
        }

        .qty-btn {
            width: 35px;
            height: 35px;
            border: none;
            background: white;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* –ü–æ–¥–≤–∞–ª —Å –∫–æ—Ä–∑–∏–Ω–æ–π */
        .cart-footer {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 18px;
            border-radius: 20px;
            display: none;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
            z-index: 1000;
        }
        .cart-footer span { font-weight: 700; font-size: 1.1rem; }
    </style>
</head>
<body>

    <header>
        <div class="logo">–ú–∞—Ä–∫–µ—Ç</div>
        <div style="font-size: 1.5rem;">üõí</div>
    </header>

    <div class="search-bar">
        <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤...">
    </div>

    <div class="categories-grid">
        <div class="cat-item"><div class="cat-icon">ü•™</div>–ï–¥–∞</div>
        <div class="cat-item"><div class="cat-icon">ü•§</div>–ù–∞–ø–∏—Ç–∫–∏</div>
        <div class="cat-item"><div class="cat-icon">üç∞</div>–î–µ—Å–µ—Ä—Ç—ã</div>
        <div class="cat-item"><div class="cat-icon">üì¶</div>–î—Ä—É–≥–æ–µ</div>
    </div>

    <h2 class="section-title">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</h2>

    <div class="products-grid" id="catalog">
        {% for item in items %}
        <div class="product-card">
            <img src="{{ item.photo_url }}" class="product-img">
            <div class="product-price">{{ item.price }} ‚ÇΩ</div>
            <div class="product-name">{{ item.name }}</div>
            
            <button class="add-btn" id="add-{{ item.id }}" onclick="updateQty('{{ item.id }}', '{{ item.name }}', {{ item.price }}, 1)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
            
            <div class="qty-controls" id="ctrl-{{ item.id }}">
                <button class="qty-btn" onclick="updateQty('{{ item.id }}', '{{ item.name }}', {{ item.price }}, -1)">‚àí</button>
                <span style="font-weight: 700;" id="count-{{ item.id }}">0</span>
                <button class="qty-btn" onclick="updateQty('{{ item.id }}', '{{ item.name }}', {{ item.price }}, 1)">+</button>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="cart-footer" id="cart-footer" onclick="sendOrder()">
        <span>–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</span>
        <span id="total-price">0 ‚ÇΩ</span>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.backgroundColor = '#ffffff';
        tg.headerColor = '#ffffff';

        let cart = {};
        let total = 0;

        function updateQty(id, name, price, delta) {
            if (!cart[id]) cart[id] = { name: name, price: price, qty: 0 };
            
            cart[id].qty += delta;
            
            const addBtn = document.getElementById(`add-${id}`);
            const ctrl = document.getElementById(`ctrl-${id}`);
            const countLabel = document.getElementById(`count-${id}`);

            if (cart[id].qty > 0) {
                addBtn.style.display = 'none';
                ctrl.style.display = 'flex';
                countLabel.innerText = cart[id].qty;
            } else {
                addBtn.style.display = 'block';
                ctrl.style.display = 'none';
                delete cart[id];
            }

            renderFooter();
            tg.HapticFeedback.impactOccurred('light');
        }

        function renderFooter() {
            total = 0;
            let count = 0;
            for (let id in cart) {
                total += cart[id].price * cart[id].qty;
                count += cart[id].qty;
            }
            
            const footer = document.getElementById('cart-footer');
            if (count > 0) {
                footer.style.display = 'flex';
                document.getElementById('total-price').innerText = total + ' ‚ÇΩ';
            } else {
                footer.style.display = 'none';
            }
        }

        function sendOrder() {
            let items = Object.values(cart);
            tg.sendData(JSON.stringify({ items: items, total: total }));
        }
    </script>
</body>
</html>

